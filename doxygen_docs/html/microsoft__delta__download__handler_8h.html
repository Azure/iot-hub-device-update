<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Device Update for IotHub: src/extensions/download_handlers/plugin_examples/microsoft_delta_download_handler/handler/lib/inc/aduc/microsoft_delta_download_handler.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Device Update for IotHub
   &#160;<span id="projectnumber">1.0.1</span>
   </div>
   <div id="projectbrief">Device Update for IoTHub delivers client update from the Device Update for IotHub service.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_40c73bf2095fd0473b1b85ccdcac2768.html">extensions</a></li><li class="navelem"><a class="el" href="dir_a1bed297603bd85e845cfcfeb80e4c7b.html">download_handlers</a></li><li class="navelem"><a class="el" href="dir_e4455ccd2e5d3a3321e45fa96ec0443d.html">plugin_examples</a></li><li class="navelem"><a class="el" href="dir_501536a4684818e7955e733f956e333e.html">microsoft_delta_download_handler</a></li><li class="navelem"><a class="el" href="dir_e9e4c1d30cea4d13b7c5178c1375e37d.html">handler</a></li><li class="navelem"><a class="el" href="dir_1e144c6b4001da09bd44894ea462d0b2.html">lib</a></li><li class="navelem"><a class="el" href="dir_0be3997be201b2c0e08bde7e23835abc.html">inc</a></li><li class="navelem"><a class="el" href="dir_68f776d0f7580c495f16b5567aeedf9a.html">aduc</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">microsoft_delta_download_handler.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Function prototypes for the delta download handler library functions used by the sample libmicrosoft_delta_download_handler.so plugin.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;<a class="el" href="result_8h_source.html">aduc/result.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="update__content_8h_source.html">aduc/types/update_content.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="workflow_8h_source.html">aduc/types/workflow.h</a>&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for microsoft_delta_download_handler.h:</div>
<div class="dyncontent">
<div class="center"><img src="microsoft__delta__download__handler_8h__incl.png" border="0" usemap="#src_2extensions_2download__handlers_2plugin__examples_2microsoft__delta__download__handler_2handler_2lib_2inc_2aduc_2microsoft__delta__download__handler_8h" alt=""/></div>
<map name="src_2extensions_2download__handlers_2plugin__examples_2microsoft__delta__download__handler_2handler_2lib_2inc_2aduc_2microsoft__delta__download__handler_8h" id="src_2extensions_2download__handlers_2plugin__examples_2microsoft__delta__download__handler_2handler_2lib_2inc_2aduc_2microsoft__delta__download__handler_8h">
<area shape="rect" title="Function prototypes for the delta download handler library functions used by the sample libmicrosoft_..." alt="" coords="417,5,681,91"/>
<area shape="rect" href="result_8h.html" title="Describes the ADUC result type. Generated from result_codes.json by ErrorCodeDefinitionGenerator...." alt="" coords="849,288,956,315"/>
<area shape="rect" href="update__content_8h.html" title="Defines types related to Update Content data." alt="" coords="5,288,216,315"/>
<area shape="rect" href="workflow_8h.html" title="Define types for Device Update agent workflow." alt="" coords="466,139,633,165"/>
<area shape="rect" title=" " alt="" coords="560,437,643,464"/>
<area shape="rect" title=" " alt="" coords="703,363,774,389"/>
<area shape="rect" href="hash_8h.html" title="Defines types related to hashing functionality." alt="" coords="247,363,387,389"/>
<area shape="rect" title=" " alt="" coords="179,437,253,464"/>
<area shape="rect" href="c__utils_8h.html" title="Helpers and macros for C code." alt="" coords="282,437,393,464"/>
<area shape="rect" title=" " alt="" coords="342,213,413,240"/>
<area shape="rect" href="adu__core_8h.html" title="Describes types used in ADUC agent code." alt="" coords="540,213,708,240"/>
<area shape="rect" href="download_8h.html" title="Defines types related to file download functionality." alt="" coords="653,288,825,315"/>
<area shape="rect" title=" " alt="" coords="437,213,515,240"/>
<area shape="rect" href="adu__types_8h.html" title="Defines common types used throughout Device Update agent components." alt="" coords="412,363,548,389"/>
<area shape="rect" href="logging_8h.html" title="Maps logging macros to the appropriate logging library functions." alt="" coords="419,437,536,464"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="microsoft__delta__download__handler_8h__dep__incl.png" border="0" usemap="#src_2extensions_2download__handlers_2plugin__examples_2microsoft__delta__download__handler_2handler_2lib_2inc_2aduc_2microsoft__delta__download__handler_8hdep" alt=""/></div>
<map name="src_2extensions_2download__handlers_2plugin__examples_2microsoft__delta__download__handler_2handler_2lib_2inc_2aduc_2microsoft__delta__download__handler_8hdep" id="src_2extensions_2download__handlers_2plugin__examples_2microsoft__delta__download__handler_2handler_2lib_2inc_2aduc_2microsoft__delta__download__handler_8hdep">
<area shape="rect" title="Function prototypes for the delta download handler library functions used by the sample libmicrosoft_..." alt="" coords="127,5,391,91"/>
<area shape="rect" href="microsoft__delta__download__handler_8c.html" title="Implementation for the delta download handler library functions used by the sample libmicrosoft_delta..." alt="" coords="5,146,244,231"/>
<area shape="rect" href="microsoft__delta__download__handler__plugin_8EXPORTS_8c.html" title="An example implementation of a DownloadHandler plugin module that produces full target updates using ..." alt="" coords="269,139,522,239"/>
</map>
</div>
</div>
<p><a href="microsoft__delta__download__handler_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a2124de07b297b449231f21507737cdea"><td class="memItemLeft" align="right" valign="top"><a class="el" href="result_8h.html#af1a9740f595ec28855281b88f89ece17">ADUC_Result</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsoft__delta__download__handler_8h.html#a2124de07b297b449231f21507737cdea">MicrosoftDeltaDownloadHandler_ProcessUpdate</a> (const ADUC_WorkflowHandle workflowHandle, const <a class="el" href="update__content_8h.html#a63f830e0d273af31a550c214158c50b2">ADUC_FileEntity</a> *fileEntity, const char *payloadFilePath, const char *updateCacheBasePath)</td></tr>
<tr class="memdesc:a2124de07b297b449231f21507737cdea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes the target update from FileEntity metadata at the given output filepath. For this download handler, each relatedFile in the FileEntity metadata represents a delta update, which is much smaller than the target update content. It attempts to download the delta update and produce the target update using the delta processor. If successful, it tells the agent to skip download; otherwise, it tells the agent that a full download is required.  <a href="microsoft__delta__download__handler_8h.html#a2124de07b297b449231f21507737cdea">More...</a><br /></td></tr>
<tr class="separator:a2124de07b297b449231f21507737cdea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68534967182a39ded2df2b71ec5fa4c9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="result_8h.html#af1a9740f595ec28855281b88f89ece17">ADUC_Result</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsoft__delta__download__handler_8h.html#a68534967182a39ded2df2b71ec5fa4c9">MicrosoftDeltaDownloadHandler_OnUpdateWorkflowCompleted</a> (const ADUC_WorkflowHandle workflowHandle, const char *updateCacheBasePath)</td></tr>
<tr class="memdesc:a68534967182a39ded2df2b71ec5fa4c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called when the update workflow successfully completes. In the case of Delta download handler plugin, it moves all the payload files from download sandbox to the cache.  <a href="microsoft__delta__download__handler_8h.html#a68534967182a39ded2df2b71ec5fa4c9">More...</a><br /></td></tr>
<tr class="separator:a68534967182a39ded2df2b71ec5fa4c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Function prototypes for the delta download handler library functions used by the sample libmicrosoft_delta_download_handler.so plugin. </p>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright (c) Microsoft Corporation. Licensed under the MIT License. </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a68534967182a39ded2df2b71ec5fa4c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68534967182a39ded2df2b71ec5fa4c9">&#9670;&nbsp;</a></span>MicrosoftDeltaDownloadHandler_OnUpdateWorkflowCompleted()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="result_8h.html#af1a9740f595ec28855281b88f89ece17">ADUC_Result</a> MicrosoftDeltaDownloadHandler_OnUpdateWorkflowCompleted </td>
          <td>(</td>
          <td class="paramtype">const ADUC_WorkflowHandle&#160;</td>
          <td class="paramname"><em>workflowHandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>updateCacheBasePath</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called when the update workflow successfully completes. In the case of Delta download handler plugin, it moves all the payload files from download sandbox to the cache. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">workflowHandle</td><td>The workflow handle. </td></tr>
    <tr><td class="paramname">updateCacheBasePath</td><td>The update cache base path. Use NULL for default. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ADUC_Result The result.</dd></dl>
<p>Called when the update workflow successfully completes. In the case of Delta download handler plugin, it moves all the payload files from download sandbox to the cache.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">workflowHandle</td><td>The workflow handle. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">updateCacheBasePath</td><td>The update cache base path. Use NULL for default. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ADUC_Result The result. </dd></dl>

</div>
</div>
<a id="a2124de07b297b449231f21507737cdea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2124de07b297b449231f21507737cdea">&#9670;&nbsp;</a></span>MicrosoftDeltaDownloadHandler_ProcessUpdate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="result_8h.html#af1a9740f595ec28855281b88f89ece17">ADUC_Result</a> MicrosoftDeltaDownloadHandler_ProcessUpdate </td>
          <td>(</td>
          <td class="paramtype">const ADUC_WorkflowHandle&#160;</td>
          <td class="paramname"><em>workflowHandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="update__content_8h.html#a63f830e0d273af31a550c214158c50b2">ADUC_FileEntity</a> *&#160;</td>
          <td class="paramname"><em>fileEntity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>payloadFilePath</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>updateCacheBasePath</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Processes the target update from FileEntity metadata at the given output filepath. For this download handler, each relatedFile in the FileEntity metadata represents a delta update, which is much smaller than the target update content. It attempts to download the delta update and produce the target update using the delta processor. If successful, it tells the agent to skip download; otherwise, it tells the agent that a full download is required. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">workflowHandle</td><td>The workflow handle. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fileEntity</td><td>The FileEntity metadata of the update content and its related files. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">payloadFilePath</td><td>The sandbox output filepath where the update content would normally be written. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">updateCacheBasePath</td><td>The update cache base path. Use NULL for default. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ADUC_Result The result. On success, returns ADUC_Result_Download_Handler_SuccessSkipDownload to tell the agent to skip downloading the update content (since it was able to produce it at the payloadFilePath). On failure, returns ADUC_Result_Download_Handler_RequiredFullDownload success ResultCode to tell the agent to download the update content as a fallback measure. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
