<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Device Update for IotHub: src/utils/jws_utils/src/jws_utils.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Device Update for IotHub
   &#160;<span id="projectnumber">1.0.1</span>
   </div>
   <div id="projectbrief">Device Update for IoTHub delivers client update from the Device Update for IotHub service.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_313caf1132e152dd9b58bea13a4052ca.html">utils</a></li><li class="navelem"><a class="el" href="dir_b96fcac37725335f3c5ba2a61f5b7158.html">jws_utils</a></li><li class="navelem"><a class="el" href="dir_f8b3e2bbad71df641bdf45ef072f8d34.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">jws_utils.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Provides methods for verifying Signed JSON Web Keys, JSON Web Tokens in JSON Web Signature Format, and JSON Web Signatures.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="jws__utils_8h_source.html">jws_utils.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="base64__utils_8h_source.html">base64_utils.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="crypto__lib_8h_source.html">crypto_lib.h</a>&quot;</code><br />
<code>#include &lt;azure_c_shared_utility/azure_base64.h&gt;</code><br />
<code>#include &lt;azure_c_shared_utility/crt_abstractions.h&gt;</code><br />
<code>#include &lt;parson.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for jws_utils.c:</div>
<div class="dyncontent">
<div class="center"><img src="jws__utils_8c__incl.png" border="0" usemap="#src_2utils_2jws__utils_2src_2jws__utils_8c" alt=""/></div>
<map name="src_2utils_2jws__utils_2src_2jws__utils_8c" id="src_2utils_2jws__utils_2src_2jws__utils_8c">
<area shape="rect" title="Provides methods for verifying Signed JSON Web Keys, JSON Web Tokens in JSON Web Signature Format,..." alt="" coords="706,5,841,47"/>
<area shape="rect" href="jws__utils_8h.html" title="Provides helper methods for parsing and verifying JSON Web Keys and JSON Web Tokens." alt="" coords="119,102,209,129"/>
<area shape="rect" href="base64__utils_8h.html" title="Provides an implementation for Base64 encoding and decoding." alt="" coords="357,102,473,129"/>
<area shape="rect" href="crypto__lib_8h.html" title="Provides an implementation of cryptogrpahic functions for hashing, encrypting, and verifiying." alt="" coords="233,102,332,129"/>
<area shape="rect" title=" " alt="" coords="497,95,665,136"/>
<area shape="rect" title=" " alt="" coords="689,95,857,136"/>
<area shape="rect" title=" " alt="" coords="882,102,961,129"/>
<area shape="rect" href="stdio_8h_source.html" title=" " alt="" coords="985,102,1052,129"/>
<area shape="rect" href="stdlib_8h_source.html" title=" " alt="" coords="1101,102,1171,129"/>
<area shape="rect" title=" " alt="" coords="1219,102,1290,129"/>
<area shape="rect" href="crypto__key_8h.html" title="Declares the Crypto Key Handle for the crypto_utils and jws_utils libraries." alt="" coords="113,184,215,211"/>
<area shape="rect" href="c__utils_8h.html" title="Helpers and macros for C code." alt="" coords="239,184,350,211"/>
<area shape="rect" title=" " alt="" coords="5,184,88,211"/>
<area shape="rect" title=" " alt="" coords="469,184,544,211"/>
<area shape="rect" title=" " alt="" coords="374,184,445,211"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a351dc9ada247a8e9b06e4098c117c813"><td class="memItemLeft" align="right" valign="top"><a class="el" href="jws__utils_8h.html#af22847408e80797afa57fb41917bf722">JWSResult</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="jws__utils_8c.html#a351dc9ada247a8e9b06e4098c117c813">VerifySJWK</a> (const char *sjwk)</td></tr>
<tr class="memdesc:a351dc9ada247a8e9b06e4098c117c813"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verifies the Base64URL encoded <code>sjwk</code> in Signed JSON Web Key (SJWK) format using the KiD found within the encoded JWKs Header.  <a href="jws__utils_8c.html#a351dc9ada247a8e9b06e4098c117c813">More...</a><br /></td></tr>
<tr class="separator:a351dc9ada247a8e9b06e4098c117c813"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8f26d2d8759fa8f81968ca08f8aedcb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="jws__utils_8h.html#af22847408e80797afa57fb41917bf722">JWSResult</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="jws__utils_8c.html#ab8f26d2d8759fa8f81968ca08f8aedcb">VerifyJWSWithSJWK</a> (const char *jws)</td></tr>
<tr class="memdesc:ab8f26d2d8759fa8f81968ca08f8aedcb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verifies the BASE64URL encoded <code>blob</code> JSON Web Signature (JWS) using the key held within the Signed JSON Web Key header parameter.  <a href="jws__utils_8c.html#ab8f26d2d8759fa8f81968ca08f8aedcb">More...</a><br /></td></tr>
<tr class="separator:ab8f26d2d8759fa8f81968ca08f8aedcb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3075ffac09869026077122823ab58076"><td class="memItemLeft" align="right" valign="top"><a class="el" href="jws__utils_8h.html#af22847408e80797afa57fb41917bf722">JWSResult</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="jws__utils_8c.html#a3075ffac09869026077122823ab58076">VerifyJWSWithKey</a> (const char *blob, <a class="el" href="crypto__key_8h.html#a40d717a87c9752bb9c3e10abd839d9c8">CryptoKeyHandle</a> key)</td></tr>
<tr class="memdesc:a3075ffac09869026077122823ab58076"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verifies the Base64URL encoded <code>blob</code> JSON Web Signature (JWS) using <code>key</code>.  <a href="jws__utils_8c.html#a3075ffac09869026077122823ab58076">More...</a><br /></td></tr>
<tr class="separator:a3075ffac09869026077122823ab58076"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab27b0826f24b4b9ccfa1aaa44abeedcc"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="jws__utils_8c.html#ab27b0826f24b4b9ccfa1aaa44abeedcc">GetPayloadFromJWT</a> (const char *blob, char **destBuff)</td></tr>
<tr class="memdesc:ab27b0826f24b4b9ccfa1aaa44abeedcc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pulls the payload out of the JWT and converts it from base64 to a string DOES NOT VALIDATE IT.  <a href="jws__utils_8c.html#ab27b0826f24b4b9ccfa1aaa44abeedcc">More...</a><br /></td></tr>
<tr class="separator:ab27b0826f24b4b9ccfa1aaa44abeedcc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad99bd52efa01d75e28cedcbfa05c31e1"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="jws__utils_8c.html#ad99bd52efa01d75e28cedcbfa05c31e1">GetKeyFromBase64EncodedJWK</a> (const char *blob)</td></tr>
<tr class="memdesc:ad99bd52efa01d75e28cedcbfa05c31e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">parses the key from the JWK into a usable CryptoLib key  <a href="jws__utils_8c.html#ad99bd52efa01d75e28cedcbfa05c31e1">More...</a><br /></td></tr>
<tr class="separator:ad99bd52efa01d75e28cedcbfa05c31e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Provides methods for verifying Signed JSON Web Keys, JSON Web Tokens in JSON Web Signature Format, and JSON Web Signatures. </p>
<p>Provides verification methods and helper functions </p><dl class="section copyright"><dt>Copyright</dt><dd>Copyright (c) Microsoft Corporation. Licensed under the MIT License. </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ad99bd52efa01d75e28cedcbfa05c31e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad99bd52efa01d75e28cedcbfa05c31e1">&#9670;&nbsp;</a></span>GetKeyFromBase64EncodedJWK()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* GetKeyFromBase64EncodedJWK </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>blob</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>parses the key from the JWK into a usable CryptoLib key </p>
<p>Only supports RSA keys right now, more support will be added later. DOES VALIDATE THE JWK </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">blob</td><td>a Base64 encoded JSON Web Key which contains the parameters for creating a key </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a pointer to the key on success, NULL on failure </dd></dl>

</div>
</div>
<a id="ab27b0826f24b4b9ccfa1aaa44abeedcc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab27b0826f24b4b9ccfa1aaa44abeedcc">&#9670;&nbsp;</a></span>GetPayloadFromJWT()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool GetPayloadFromJWT </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>blob</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>destBuff</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Pulls the payload out of the JWT and converts it from base64 to a string DOES NOT VALIDATE IT. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">blob</td><td>a Base64URL encoded JSON Web Token (JWT) in JSON Web Signature format </td></tr>
    <tr><td class="paramname">destBuff</td><td>the destination buffer for the JWT's payload, allocated within the function </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a value of JWSResult </dd></dl>

</div>
</div>
<a id="a3075ffac09869026077122823ab58076"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3075ffac09869026077122823ab58076">&#9670;&nbsp;</a></span>VerifyJWSWithKey()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="jws__utils_8h.html#af22847408e80797afa57fb41917bf722">JWSResult</a> VerifyJWSWithKey </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>blob</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="crypto__key_8h.html#a40d717a87c9752bb9c3e10abd839d9c8">CryptoKeyHandle</a>&#160;</td>
          <td class="paramname"><em>key</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Verifies the Base64URL encoded <code>blob</code> JSON Web Signature (JWS) using <code>key</code>. </p>
<p>Function expects a Base64URL encoded <code>blob</code> in JSON Web Signature format and verifies its signature using <code>key</code> </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">blob</td><td>a Base64URL encoded JSON Web Token in JSON Web Signature format </td></tr>
    <tr><td class="paramname">key</td><td>the public key created with the crypto_lib functions that corresponds to the one used to sign the <code>blob</code> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a value of JWSResult </dd></dl>

</div>
</div>
<a id="ab8f26d2d8759fa8f81968ca08f8aedcb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8f26d2d8759fa8f81968ca08f8aedcb">&#9670;&nbsp;</a></span>VerifyJWSWithSJWK()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="jws__utils_8h.html#af22847408e80797afa57fb41917bf722">JWSResult</a> VerifyJWSWithSJWK </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>jws</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Verifies the BASE64URL encoded <code>blob</code> JSON Web Signature (JWS) using the key held within the Signed JSON Web Key header parameter. </p>
<p>Verifies the Signed JSON Web Key (SJWK) and uses the key from the SJWK to validate the JSON Web Signature <code>blob</code> </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">jws</td><td>a Base64URL encoded JSON Web Token in JSON Web Signature format with a Signed JSON Web Key within the header </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a value of JWSResult </dd></dl>

</div>
</div>
<a id="a351dc9ada247a8e9b06e4098c117c813"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a351dc9ada247a8e9b06e4098c117c813">&#9670;&nbsp;</a></span>VerifySJWK()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="jws__utils_8h.html#af22847408e80797afa57fb41917bf722">JWSResult</a> VerifySJWK </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sjwk</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Verifies the Base64URL encoded <code>sjwk</code> in Signed JSON Web Key (SJWK) format using the KiD found within the encoded JWKs Header. </p>
<p>A Signed JSON Web Key (SJWK) is JWK in JSON Web Signature (JWS) format. The function parses the header for the kid, builds the associated key, and then verifies the signature of the JWK </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sjwk</td><td>a base64URL encoded string that contains the Signed JSON Web Key </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a value of JWSResult </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
