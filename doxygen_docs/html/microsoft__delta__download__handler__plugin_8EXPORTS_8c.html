<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Device Update for IotHub: src/extensions/download_handlers/plugin_examples/microsoft_delta_download_handler/handler/plugin/src/microsoft_delta_download_handler_plugin.EXPORTS.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Device Update for IotHub
   &#160;<span id="projectnumber">1.0.1</span>
   </div>
   <div id="projectbrief">Device Update for IoTHub delivers client update from the Device Update for IotHub service.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_40c73bf2095fd0473b1b85ccdcac2768.html">extensions</a></li><li class="navelem"><a class="el" href="dir_a1bed297603bd85e845cfcfeb80e4c7b.html">download_handlers</a></li><li class="navelem"><a class="el" href="dir_e4455ccd2e5d3a3321e45fa96ec0443d.html">plugin_examples</a></li><li class="navelem"><a class="el" href="dir_501536a4684818e7955e733f956e333e.html">microsoft_delta_download_handler</a></li><li class="navelem"><a class="el" href="dir_e9e4c1d30cea4d13b7c5178c1375e37d.html">handler</a></li><li class="navelem"><a class="el" href="dir_ca0b9f4dfdad68f49523a1d7b8aa4c38.html">plugin</a></li><li class="navelem"><a class="el" href="dir_6ab30fa2229914c725906159d39c1cfa.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">microsoft_delta_download_handler_plugin.EXPORTS.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>An example implementation of a DownloadHandler plugin module that produces full target updates using a source update update cache and can cache updates once they've been verified to be good upon workflow success.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="microsoft__delta__download__handler_8h_source.html">aduc/microsoft_delta_download_handler.h</a>&quot;</code><br />
<code>#include &lt;<a class="el" href="contract__utils_8h_source.html">aduc/contract_utils.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="logging_8h_source.html">aduc/logging.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="adu__core_8h_source.html">aduc/types/adu_core.h</a>&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for microsoft_delta_download_handler_plugin.EXPORTS.c:</div>
<div class="dyncontent">
<div class="center"><img src="microsoft__delta__download__handler__plugin_8EXPORTS_8c__incl.png" border="0" usemap="#src_2extensions_2download__handlers_2plugin__examples_2microsoft__delta__download__handler_2handler_2plugin_2src_2microsoft__delta__download__handler__plugin_8EXPORTS_8c" alt=""/></div>
<map name="src_2extensions_2download__handlers_2plugin__examples_2microsoft__delta__download__handler_2handler_2plugin_2src_2microsoft__delta__download__handler__plugin_8EXPORTS_8c" id="src_2extensions_2download__handlers_2plugin__examples_2microsoft__delta__download__handler_2handler_2plugin_2src_2microsoft__delta__download__handler__plugin_8EXPORTS_8c">
<area shape="rect" title="An example implementation of a DownloadHandler plugin module that produces full target updates using ..." alt="" coords="717,5,970,105"/>
<area shape="rect" href="microsoft__delta__download__handler_8h.html" title="Function prototypes for the delta download handler library functions used by the sample libmicrosoft_..." alt="" coords="544,153,703,195"/>
<area shape="rect" href="adu__core_8h.html" title="Describes types used in ADUC agent code." alt="" coords="647,317,815,344"/>
<area shape="rect" href="logging_8h.html" title="Maps logging macros to the appropriate logging library functions." alt="" coords="902,541,1019,568"/>
<area shape="rect" href="contract__utils_8h.html" title="The header for contract utils." alt="" coords="63,317,221,344"/>
<area shape="rect" href="result_8h.html" title="Describes the ADUC result type. Generated from result_codes.json by ErrorCodeDefinitionGenerator...." alt="" coords="177,392,283,419"/>
<area shape="rect" href="update__content_8h.html" title="Defines types related to Update Content data." alt="" coords="769,392,979,419"/>
<area shape="rect" href="workflow_8h.html" title="Define types for Device Update agent workflow." alt="" coords="431,243,597,269"/>
<area shape="rect" title=" " alt="" coords="227,541,310,568"/>
<area shape="rect" title=" " alt="" coords="301,467,372,493"/>
<area shape="rect" href="hash_8h.html" title="Defines types related to hashing functionality." alt="" coords="448,467,588,493"/>
<area shape="rect" title=" " alt="" coords="695,541,770,568"/>
<area shape="rect" href="c__utils_8h.html" title="Helpers and macros for C code." alt="" coords="463,541,573,568"/>
<area shape="rect" title=" " alt="" coords="552,317,623,344"/>
<area shape="rect" href="download_8h.html" title="Defines types related to file download functionality." alt="" coords="308,392,480,419"/>
<area shape="rect" title=" " alt="" coords="397,317,476,344"/>
<area shape="rect" href="adu__types_8h.html" title="Defines common types used throughout Device Update agent components." alt="" coords="613,467,749,493"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:abd01c8ab2a0e84bf00400d74357e4740"><td class="memItemLeft" align="right" valign="top"><a class="el" href="c__utils_8h.html#ab7fe54e94791b2958ad336beba8a053a">EXPORTED_METHOD</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsoft__delta__download__handler__plugin_8EXPORTS_8c.html#abd01c8ab2a0e84bf00400d74357e4740">Initialize</a> (ADUC_LOG_SEVERITY logLevel)</td></tr>
<tr class="memdesc:abd01c8ab2a0e84bf00400d74357e4740"><td class="mdescLeft">&#160;</td><td class="mdescRight">One-time initialization for the download handler.  <a href="microsoft__delta__download__handler__plugin_8EXPORTS_8c.html#abd01c8ab2a0e84bf00400d74357e4740">More...</a><br /></td></tr>
<tr class="separator:abd01c8ab2a0e84bf00400d74357e4740"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57d3daebcb78f38db7c72ee39d4a77f5"><td class="memItemLeft" align="right" valign="top"><a id="a57d3daebcb78f38db7c72ee39d4a77f5"></a>
<a class="el" href="c__utils_8h.html#ab7fe54e94791b2958ad336beba8a053a">EXPORTED_METHOD</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsoft__delta__download__handler__plugin_8EXPORTS_8c.html#a57d3daebcb78f38db7c72ee39d4a77f5">Cleanup</a> ()</td></tr>
<tr class="memdesc:a57d3daebcb78f38db7c72ee39d4a77f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cleanup logic before library is unloaded. <br /></td></tr>
<tr class="separator:a57d3daebcb78f38db7c72ee39d4a77f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3459b0ac021dc96cc0628a57220ba68d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="c__utils_8h.html#ab7fe54e94791b2958ad336beba8a053a">EXPORTED_METHOD</a> <a class="el" href="result_8h.html#af1a9740f595ec28855281b88f89ece17">ADUC_Result</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsoft__delta__download__handler__plugin_8EXPORTS_8c.html#a3459b0ac021dc96cc0628a57220ba68d">ProcessUpdate</a> (const ADUC_WorkflowHandle workflowHandle, const <a class="el" href="update__content_8h.html#a63f830e0d273af31a550c214158c50b2">ADUC_FileEntity</a> *fileEntity, const char *targetUpdateFilePath)</td></tr>
<tr class="memdesc:a3459b0ac021dc96cc0628a57220ba68d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes the target update from FileEntity metadata at the given output filepath. For this download handler, each relatedFile in the FileEntity metadata represents a delta update, which is much smaller than the target update content. It attempts to download the delta update and produce the target update using the delta processor. If successful, it tells the agent to skip download; otherwise, it tells the agent that a full download is required.  <a href="microsoft__delta__download__handler__plugin_8EXPORTS_8c.html#a3459b0ac021dc96cc0628a57220ba68d">More...</a><br /></td></tr>
<tr class="separator:a3459b0ac021dc96cc0628a57220ba68d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3dc445bbca848745da01db356e6ecd4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="c__utils_8h.html#ab7fe54e94791b2958ad336beba8a053a">EXPORTED_METHOD</a> <a class="el" href="result_8h.html#af1a9740f595ec28855281b88f89ece17">ADUC_Result</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsoft__delta__download__handler__plugin_8EXPORTS_8c.html#aa3dc445bbca848745da01db356e6ecd4">OnUpdateWorkflowCompleted</a> (const ADUC_WorkflowHandle workflowHandle)</td></tr>
<tr class="memdesc:aa3dc445bbca848745da01db356e6ecd4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called when the update workflow successfully completes. In the case of Delta download handler plugin, it moves all the payloads from sandbox to cache so that they will available as source updates for future delta updates.  <a href="microsoft__delta__download__handler__plugin_8EXPORTS_8c.html#aa3dc445bbca848745da01db356e6ecd4">More...</a><br /></td></tr>
<tr class="separator:aa3dc445bbca848745da01db356e6ecd4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a365183e6047be2b70da9acf4ad6d4933"><td class="memItemLeft" align="right" valign="top"><a class="el" href="c__utils_8h.html#ab7fe54e94791b2958ad336beba8a053a">EXPORTED_METHOD</a> <a class="el" href="result_8h.html#af1a9740f595ec28855281b88f89ece17">ADUC_Result</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsoft__delta__download__handler__plugin_8EXPORTS_8c.html#a365183e6047be2b70da9acf4ad6d4933">GetContractInfo</a> (<a class="el" href="contract__utils_8h.html#af28abb5bb7ddb74358da9d2648656c38">ADUC_ExtensionContractInfo</a> *contractInfo)</td></tr>
<tr class="memdesc:a365183e6047be2b70da9acf4ad6d4933"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the extension contract info.  <a href="microsoft__delta__download__handler__plugin_8EXPORTS_8c.html#a365183e6047be2b70da9acf4ad6d4933">More...</a><br /></td></tr>
<tr class="separator:a365183e6047be2b70da9acf4ad6d4933"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>An example implementation of a DownloadHandler plugin module that produces full target updates using a source update update cache and can cache updates once they've been verified to be good upon workflow success. </p>
<p>This plugin module provides the following exported function symbols to satisfy the DownloadHandler agent interface: Initialize - Do one-time initialization (e.g. initialize logging), Cleanup - Free resources and cleanup right before unloading, ProcessUpdate - Do processing using data provided by ADUC_WorkflowHandle and update file metadata (ADUC_FileEntity), OnUpdateWorkflowCompleted - Callback for post-processing when the current update has been installed and applied successfully.</p>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright (c) Microsoft Corporation. Licensed under the MIT License. </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a365183e6047be2b70da9acf4ad6d4933"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a365183e6047be2b70da9acf4ad6d4933">&#9670;&nbsp;</a></span>GetContractInfo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="c__utils_8h.html#ab7fe54e94791b2958ad336beba8a053a">EXPORTED_METHOD</a> <a class="el" href="result_8h.html#af1a9740f595ec28855281b88f89ece17">ADUC_Result</a> GetContractInfo </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="contract__utils_8h.html#af28abb5bb7ddb74358da9d2648656c38">ADUC_ExtensionContractInfo</a> *&#160;</td>
          <td class="paramname"><em>contractInfo</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Gets the extension contract info. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">contractInfo</td><td>The extension contract info. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ADUC_Result The result. </dd></dl>

</div>
</div>
<a id="abd01c8ab2a0e84bf00400d74357e4740"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd01c8ab2a0e84bf00400d74357e4740">&#9670;&nbsp;</a></span>Initialize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="c__utils_8h.html#ab7fe54e94791b2958ad336beba8a053a">EXPORTED_METHOD</a> void Initialize </td>
          <td>(</td>
          <td class="paramtype">ADUC_LOG_SEVERITY&#160;</td>
          <td class="paramname"><em>logLevel</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>One-time initialization for the download handler. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">logLevel</td><td>The desired loglevel if logging is used. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aa3dc445bbca848745da01db356e6ecd4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3dc445bbca848745da01db356e6ecd4">&#9670;&nbsp;</a></span>OnUpdateWorkflowCompleted()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="c__utils_8h.html#ab7fe54e94791b2958ad336beba8a053a">EXPORTED_METHOD</a> <a class="el" href="result_8h.html#af1a9740f595ec28855281b88f89ece17">ADUC_Result</a> OnUpdateWorkflowCompleted </td>
          <td>(</td>
          <td class="paramtype">const ADUC_WorkflowHandle&#160;</td>
          <td class="paramname"><em>workflowHandle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called when the update workflow successfully completes. In the case of Delta download handler plugin, it moves all the payloads from sandbox to cache so that they will available as source updates for future delta updates. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">workflowHandle</td><td>The workflow handle. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ADUC_Result The result. </dd></dl>

</div>
</div>
<a id="a3459b0ac021dc96cc0628a57220ba68d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3459b0ac021dc96cc0628a57220ba68d">&#9670;&nbsp;</a></span>ProcessUpdate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="c__utils_8h.html#ab7fe54e94791b2958ad336beba8a053a">EXPORTED_METHOD</a> <a class="el" href="result_8h.html#af1a9740f595ec28855281b88f89ece17">ADUC_Result</a> ProcessUpdate </td>
          <td>(</td>
          <td class="paramtype">const ADUC_WorkflowHandle&#160;</td>
          <td class="paramname"><em>workflowHandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="update__content_8h.html#a63f830e0d273af31a550c214158c50b2">ADUC_FileEntity</a> *&#160;</td>
          <td class="paramname"><em>fileEntity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>targetUpdateFilePath</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Processes the target update from FileEntity metadata at the given output filepath. For this download handler, each relatedFile in the FileEntity metadata represents a delta update, which is much smaller than the target update content. It attempts to download the delta update and produce the target update using the delta processor. If successful, it tells the agent to skip download; otherwise, it tells the agent that a full download is required. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">workflowHandle</td><td>The workflow handle. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fileEntity</td><td>The FileEntity metadata of the update content and its related files. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">targetUpdateFilePath</td><td>The target update path to write the update content when returning ADUC_Result_Download_Handler_SuccessSkipDownload. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ADUC_Result The result. Returning ADUC_Result_Download_Handler_SuccessSkipDownload ResultCode tells the agent to skip downloading the update content (since this download handler able to produce it at the targetUpdateFilePath). Returning ADUC_Result_Download_Handler_RequiredFullDownload ResultCode tells the agent to download the update content (this download handler did not produce it by other means). </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
