<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Device Update for IotHub: src/agent/pnp_helper/inc/pnp_protocol.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Device Update for IotHub
   &#160;<span id="projectnumber">1.0.1</span>
   </div>
   <div id="projectbrief">Device Update for IoTHub delivers client update from the Device Update for IotHub service.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_7a595b6a07cd8b16c4e5e314d67cc75b.html">agent</a></li><li class="navelem"><a class="el" href="dir_885a5a7032c788277ffbb4b91a4ba16d.html">pnp_helper</a></li><li class="navelem"><a class="el" href="dir_d49e5f32f66cccd6ae1c6d04016fc52d.html">inc</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">pnp_protocol.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Header for PNP Protocol helper PnP is a convention built on top of existing IoTHub device transport primitives. This header implements functions to aide applications in serializing and deserializing PnP data. Note that actually sending and receiving the data from the underlying IoTHub client is the application's responsibility.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;azure_c_shared_utility/strings.h&quot;</code><br />
<code>#include &quot;iothub_client_core_common.h&quot;</code><br />
<code>#include &quot;iothub_message.h&quot;</code><br />
<code>#include &quot;parson.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for pnp_protocol.h:</div>
<div class="dyncontent">
<div class="center"><img src="pnp__protocol_8h__incl.png" border="0" usemap="#src_2agent_2pnp__helper_2inc_2pnp__protocol_8h" alt=""/></div>
<map name="src_2agent_2pnp__helper_2inc_2pnp__protocol_8h" id="src_2agent_2pnp__helper_2inc_2pnp__protocol_8h">
<area shape="rect" title="Header for PNP Protocol helper PnP is a convention built on top of existing IoTHub device transport p..." alt="" coords="271,5,430,47"/>
<area shape="rect" title=" " alt="" coords="5,95,173,136"/>
<area shape="rect" title=" " alt="" coords="197,95,339,136"/>
<area shape="rect" title=" " alt="" coords="363,102,504,129"/>
<area shape="rect" title=" " alt="" coords="529,102,607,129"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="pnp__protocol_8h__dep__incl.png" border="0" usemap="#src_2agent_2pnp__helper_2inc_2pnp__protocol_8hdep" alt=""/></div>
<map name="src_2agent_2pnp__helper_2inc_2pnp__protocol_8hdep" id="src_2agent_2pnp__helper_2inc_2pnp__protocol_8hdep">
<area shape="rect" title="Header for PNP Protocol helper PnP is a convention built on top of existing IoTHub device transport p..." alt="" coords="389,5,547,47"/>
<area shape="rect" href="adu__core__interface_8c.html" title="Methods to communicate with &quot;urn:azureiot:AzureDeviceUpdateCore:1&quot; interface." alt="" coords="5,95,179,151"/>
<area shape="rect" href="device__info__interface_8c.html" title="Methods to communicate with &quot;dtmi:azure:DeviceManagement:DeviceInformation;1&quot; interface." alt="" coords="203,95,365,151"/>
<area shape="rect" href="pnp__protocol_8c.html" title="PNP Protocol helper PnP is a convention built on top of existing IoTHub device transport primitives...." alt="" coords="389,102,547,143"/>
<area shape="rect" href="main_8c.html" title="Implements the main code for the Device Update Agent." alt="" coords="571,109,725,136"/>
<area shape="rect" href="diagnostics__interface_8c.html" title="Methods to communicate with &quot;dtmi:azure:iot:deviceUpdateDiagnosticModel;1&quot; interface." alt="" coords="749,95,947,151"/>
</map>
</div>
</div>
<p><a href="pnp__protocol_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a27b837f66a109c7259b170afd83e812d"><td class="memItemLeft" align="right" valign="top"><a id="a27b837f66a109c7259b170afd83e812d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pnp__protocol_8h.html#a27b837f66a109c7259b170afd83e812d">PNP_STATUS_SUCCESS</a>&#160;&#160;&#160;200</td></tr>
<tr class="memdesc:a27b837f66a109c7259b170afd83e812d"><td class="mdescLeft">&#160;</td><td class="mdescRight">PNP_STATUS_SUCCESS. <br /></td></tr>
<tr class="separator:a27b837f66a109c7259b170afd83e812d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a227bc56c563160acce05e32d1fd3ffec"><td class="memItemLeft" align="right" valign="top"><a id="a227bc56c563160acce05e32d1fd3ffec"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pnp__protocol_8h.html#a227bc56c563160acce05e32d1fd3ffec">PNP_STATUS_BAD_FORMAT</a>&#160;&#160;&#160;400</td></tr>
<tr class="memdesc:a227bc56c563160acce05e32d1fd3ffec"><td class="mdescLeft">&#160;</td><td class="mdescRight">PNP_STATUS_BAD_FORMAT. <br /></td></tr>
<tr class="separator:a227bc56c563160acce05e32d1fd3ffec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8579ab9640451fa11eabd7c999dab6d"><td class="memItemLeft" align="right" valign="top"><a id="ac8579ab9640451fa11eabd7c999dab6d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pnp__protocol_8h.html#ac8579ab9640451fa11eabd7c999dab6d">PNP_STATUS_NOT_FOUND</a>&#160;&#160;&#160;404</td></tr>
<tr class="memdesc:ac8579ab9640451fa11eabd7c999dab6d"><td class="mdescLeft">&#160;</td><td class="mdescRight">PNP_STATUS_NOT_FOUND. <br /></td></tr>
<tr class="separator:ac8579ab9640451fa11eabd7c999dab6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0188299c8f238b36222876bb5d345a76"><td class="memItemLeft" align="right" valign="top"><a id="a0188299c8f238b36222876bb5d345a76"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pnp__protocol_8h.html#a0188299c8f238b36222876bb5d345a76">PNP_STATUS_INTERNAL_ERROR</a>&#160;&#160;&#160;500</td></tr>
<tr class="memdesc:a0188299c8f238b36222876bb5d345a76"><td class="mdescLeft">&#160;</td><td class="mdescRight">PNP_STATUS_INTERNAL_ERROR. <br /></td></tr>
<tr class="separator:a0188299c8f238b36222876bb5d345a76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f05464ec1d6590beba172e059adcba5"><td class="memItemLeft" align="right" valign="top"><a id="a5f05464ec1d6590beba172e059adcba5"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pnp__protocol_8h.html#a5f05464ec1d6590beba172e059adcba5">PNP_MAXIMUM_COMPONENT_LENGTH</a>&#160;&#160;&#160;64</td></tr>
<tr class="memdesc:a5f05464ec1d6590beba172e059adcba5"><td class="mdescLeft">&#160;</td><td class="mdescRight">PNP_MAXIMUM_COMPONENT_LENGTH. <br /></td></tr>
<tr class="separator:a5f05464ec1d6590beba172e059adcba5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a609afad7bb2616c981415e1edc8908da"><td class="memItemLeft" align="right" valign="top"><a id="a609afad7bb2616c981415e1edc8908da"></a>
typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pnp__protocol_8h.html#a609afad7bb2616c981415e1edc8908da">PnP_PropertyCallbackFunction</a>) (const char *componentName, const char *propertyName, JSON_Value *propertyValue, int version, void *userContextCallback)</td></tr>
<tr class="memdesc:a609afad7bb2616c981415e1edc8908da"><td class="mdescLeft">&#160;</td><td class="mdescRight">&lt; PnP_PropertyCallbackFunction defines the function prototype the application implements to receive a callback for each PnP property in a given Device Twin. <br /></td></tr>
<tr class="separator:a609afad7bb2616c981415e1edc8908da"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:acb5e98423a3afa95232d9769cc53dc9a"><td class="memItemLeft" align="right" valign="top">STRING_HANDLE&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pnp__protocol_8h.html#acb5e98423a3afa95232d9769cc53dc9a">PnP_CreateReportedProperty</a> (const char *componentName, const char *propertyName, const char *propertyValue)</td></tr>
<tr class="memdesc:acb5e98423a3afa95232d9769cc53dc9a"><td class="mdescLeft">&#160;</td><td class="mdescRight">PnP_CreateReportedProperty returns JSON to report a property's value from the device. This does NOT contain any metadata such as a result code or version. It is used when sending properties that are NOT marked as &lt;"writable": true&gt; in the DTDL defining the given property. The application itself needs to send this to Device Twin, using a function such as ClientHandle_SendReportedState.  <a href="pnp__protocol_8h.html#acb5e98423a3afa95232d9769cc53dc9a">More...</a><br /></td></tr>
<tr class="separator:acb5e98423a3afa95232d9769cc53dc9a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6aea01ed9ddca787d65997d930f71da"><td class="memItemLeft" align="right" valign="top">STRING_HANDLE&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pnp__protocol_8h.html#ad6aea01ed9ddca787d65997d930f71da">PnP_CreateReportedPropertyWithStatus</a> (const char *componentName, const char *propertyName, const char *propertyValue, int result, const char *description, int ackVersion)</td></tr>
<tr class="memdesc:ad6aea01ed9ddca787d65997d930f71da"><td class="mdescLeft">&#160;</td><td class="mdescRight">PnP_CreateReportedProperty returns JSON to report a property's value from the device. This contains metadata such as a result code or version. It is used when responding to a desired property change request from the server, and in particular for properties marked with &lt;"writable": true&gt;. For instance, after processing a thermostat's set point the application acknowledges that it has received the request and can indicate whether it will attempt to honor the request or whether the request was unsuccessful.  <a href="pnp__protocol_8h.html#ad6aea01ed9ddca787d65997d930f71da">More...</a><br /></td></tr>
<tr class="separator:ad6aea01ed9ddca787d65997d930f71da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa19872c3fe6f98f910bedfb3b9cfc824"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pnp__protocol_8h.html#aa19872c3fe6f98f910bedfb3b9cfc824">PnP_ParseCommandName</a> (const char *deviceMethodName, unsigned const char **componentName, size_t *componentNameSize, const char **pnpCommandName)</td></tr>
<tr class="memdesc:aa19872c3fe6f98f910bedfb3b9cfc824"><td class="mdescLeft">&#160;</td><td class="mdescRight">PnP_ParseCommandName is invoked by the application when an incoming device method arrives. This function parses the device method name into the targeted (optional) component and PnP specific command. Note that because we don't want to allocate separate buffers for componentName and pnpCommandName and we can't modify deviceMethodName in place, we return the componentName as a non-NULL terminated character array with its length in componentNameSize.  <a href="pnp__protocol_8h.html#aa19872c3fe6f98f910bedfb3b9cfc824">More...</a><br /></td></tr>
<tr class="separator:aa19872c3fe6f98f910bedfb3b9cfc824"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa69a267a01f5b3e6aeef91bfda110adf"><td class="memItemLeft" align="right" valign="top">IOTHUB_MESSAGE_HANDLE&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pnp__protocol_8h.html#aa69a267a01f5b3e6aeef91bfda110adf">PnP_CreateTelemetryMessageHandle</a> (const char *componentName, const char *telemetryData)</td></tr>
<tr class="memdesc:aa69a267a01f5b3e6aeef91bfda110adf"><td class="mdescLeft">&#160;</td><td class="mdescRight">PnP_CreateTelemetryMessageHandle creates an IOTHUB_MESSAGE_HANDLE that contains tho contents of the telemetryData. If the optional componentName parameter is specified, the created message will have this as a property.  <a href="pnp__protocol_8h.html#aa69a267a01f5b3e6aeef91bfda110adf">More...</a><br /></td></tr>
<tr class="separator:aa69a267a01f5b3e6aeef91bfda110adf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac685717f39926eaff5b41b6a43ce17be"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pnp__protocol_8h.html#ac685717f39926eaff5b41b6a43ce17be">PnP_ProcessTwinData</a> (DEVICE_TWIN_UPDATE_STATE updateState, const unsigned char *payload, size_t size, const char **componentsInModel, size_t numComponentsInModel, <a class="el" href="pnp__protocol_8h.html#a609afad7bb2616c981415e1edc8908da">PnP_PropertyCallbackFunction</a> pnpPropertyCallback, void *userContextCallback)</td></tr>
<tr class="memdesc:ac685717f39926eaff5b41b6a43ce17be"><td class="mdescLeft">&#160;</td><td class="mdescRight">PnP_ProcessTwinData is invoked by the application when a device twin arrives to its device twin processing callback. PnP_ProcessTwinData will visit the children of the desired portion of the twin and invoke the device's pnpPropertyCallback function for each property that it visits.  <a href="pnp__protocol_8h.html#ac685717f39926eaff5b41b6a43ce17be">More...</a><br /></td></tr>
<tr class="separator:ac685717f39926eaff5b41b6a43ce17be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memite