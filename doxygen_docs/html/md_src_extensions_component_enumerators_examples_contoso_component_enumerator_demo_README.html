<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Device Update for IotHub: Device Update for Azure IoT Hub Tutorials</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Device Update for IotHub
   &#160;<span id="projectnumber">1.0.1</span>
   </div>
   <div id="projectbrief">Device Update for IoTHub delivers client update from the Device Update for IotHub service.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Device Update for Azure IoT Hub Tutorials </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Tutorials</p><ul>
<li><a href="#tutorial-1---single-step-update">Tutorial 1</a> - Single Step Update</li>
<li><a href="#tutorial-2---multi-step-update">Tutorial 2</a> - Multi Step Update</li>
<li><a href="#tutorial-3---bundle-update-and-multi-component-update">Tutorial 3</a> - Bundle Update and Multi Component Update</li>
</ul>
<hr  />
 <h1><a class="anchor" id="autotoc_md3"></a>
Tutorial 1 - Single Inline Step Update</h1>
<p>As described in [Multi Step Ordered Execution]() document, a step can be either <code>inline</code> or <code>reference</code>.</p>
<p>This example update (Contoso.Virtual-Vacuum.1.0) demonstrates how to create an update with a single <code>inline</code> step that will install an <a class="el" href="classAPT.html" title="Exception throw by APT Parser.">APT</a> package ('tree 10.7.0-5') onto the target device.</p>
<p>Follow this <a href="#generate-example-updates">instruction</a> to generate the example update using <code>CreateSampleMSOEUpdate-1.x.ps1</code> PowerShell script.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Example Import Manifest - Contoso.Virtual-Vacuum.1.0</h2>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;updateId&quot;:  {</div>
<div class="line">                     &quot;provider&quot;:  &quot;Contoso&quot;,</div>
<div class="line">                     &quot;name&quot;:  &quot;Virtual-Vacuum&quot;,</div>
<div class="line">                     &quot;version&quot;:  &quot;1.0&quot;</div>
<div class="line">                 },</div>
<div class="line">    &quot;isDeployable&quot;:  true,</div>
<div class="line">    &quot;compatibility&quot;:  [</div>
<div class="line">                          {</div>
<div class="line">                              &quot;model&quot;:  &quot;virtual-vacuum-v1&quot;,</div>
<div class="line">                              &quot;manufacturer&quot;:  &quot;contoso&quot;</div>
<div class="line">                          }</div>
<div class="line">                      ],</div>
<div class="line">    &quot;instructions&quot;:  {</div>
<div class="line">                         &quot;steps&quot;:  [</div>
<div class="line">                                       {</div>
<div class="line">                                           &quot;type&quot;:  &quot;inline&quot;,</div>
<div class="line">                                           &quot;description&quot;:  &quot;APT update that installs libcurl4-doc package.&quot;,</div>
<div class="line">                                           &quot;handler&quot;:  &quot;microsoft/apt:1&quot;,</div>
<div class="line">                                           &quot;files&quot;:  [</div>
<div class="line">                                                         &quot;apt-manifest-1.0.json&quot;</div>
<div class="line">                                                     ],</div>
<div class="line">                                           &quot;handlerProperties&quot;:  {</div>
<div class="line">                                                                     &quot;installedCriteria&quot;:  &quot;apt-update-test-1.1&quot;</div>
<div class="line">                                                                 }</div>
<div class="line">                                       }</div>
<div class="line">                                   ]</div>
<div class="line">                     },</div>
<div class="line">    &quot;files&quot;:  [</div>
<div class="line">                  {</div>
<div class="line">                      &quot;filename&quot;:  &quot;apt-manifest-1.0.json&quot;,</div>
<div class="line">                      &quot;sizeInBytes&quot;:  132,</div>
<div class="line">                      &quot;hashes&quot;:  {</div>
<div class="line">                                     &quot;sha256&quot;:  &quot;nACI0Obg4Px/f2f85oOko3bHE0HJ8Vlq3CMafx9g2Bo=&quot;</div>
<div class="line">                                 }</div>
<div class="line">                  }</div>
<div class="line">              ],</div>
<div class="line">    &quot;createdDateTime&quot;:  &quot;2022-05-13T21:57:08.9036596Z&quot;,</div>
<div class="line">    &quot;manifestVersion&quot;:  &quot;4.0&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>From the example import manifest above, you will notice the following:</p><ul>
<li>The <code>instructions.steps</code> property (array) contains only 1 step.</li>
<li>The <code>type</code> property indicates that this is an inline step.</li>
<li>A <code>handler</code> property informs the Device Update agent which Step Handler to be used to process this step.</li>
<li>The <code>files</code> property contains a single file entity. This file is called an <a class="el" href="classAPT.html" title="Exception throw by APT Parser.">APT</a> manifest. The current implementation of <a class="el" href="classAPT.html" title="Exception throw by APT Parser.">APT</a> Step Handler requires one <a class="el" href="classAPT.html" title="Exception throw by APT Parser.">APT</a> manifest. (See <a href="./sample-updates/data-files/APT/apt-manifest-1.0.json">apt-manifest-1.0.json</a>)</li>
<li>An <code>handlerProperties.installedCriteria</code> is a string used by <a class="el" href="classAPT.html" title="Exception throw by APT Parser.">APT</a> Step Handler to determine whether this 'step' has been installed (or processed) on the target device.</li>
</ul>
<hr  />
 <h1><a class="anchor" id="autotoc_md6"></a>
Tutorial 2 - Multi Step Update</h1>
<p>A <b>Multi Step Update</b> is an update that contains at least two steps. If at least one of those steps is a <code>reference</code> step, the update will be called <code>Bundle Update</code>.</p>
<p>This example update (Contoso.Virtual-Vacuum.2.2) demonstrates how to create an update with two <code>inline</code> steps.</p><ul>
<li>Step 0 - Install an <a class="el" href="classAPT.html" title="Exception throw by APT Parser.">APT</a> package ('libcurl4-doc') onto the target device.</li>
<li>Step 1 - Install an <a class="el" href="classAPT.html" title="Exception throw by APT Parser.">APT</a> package ('tree 10.7.0-5') onto the target device.</li>
</ul>
<blockquote class="doxtable">
<p>NOTE | This demonstrates that you can use two steps to install two <a class="el" href="classAPT.html" title="Exception throw by APT Parser.">APT</a> packages. Alternatively, you can install two packages in a single step by adding both packages' information in a single <a class="el" href="classAPT.html" title="Exception throw by APT Parser.">APT</a> manifest. </p>
</blockquote>
<p>Follow this <a href="#generate-example-updates">instruction</a> to generate the example update using <code>CreateSampleMSOEUpdate-2.x.ps1</code> PowerShell script.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Example Import Manifest - Contoso.Virtual-Vacuum.2.2</h2>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;updateId&quot;:  {</div>
<div class="line">                     &quot;provider&quot;:  &quot;Contoso&quot;,</div>
<div class="line">                     &quot;name&quot;:  &quot;Virtual-Vacuum&quot;,</div>
<div class="line">                     &quot;version&quot;:  &quot;2.2&quot;</div>
<div class="line">                 },</div>
<div class="line">    &quot;isDeployable&quot;:  true,</div>
<div class="line">    &quot;compatibility&quot;:  [</div>
<div class="line">                          {</div>
<div class="line">                              &quot;model&quot;:  &quot;virtual-vacuum-v1&quot;,</div>
<div class="line">                              &quot;manufacturer&quot;:  &quot;contoso&quot;</div>
<div class="line">                          }</div>
<div class="line">                      ],</div>
<div class="line">    &quot;instructions&quot;:  {</div>
<div class="line">                         &quot;steps&quot;:  [</div>
<div class="line">                                       {</div>
<div class="line">                                           &quot;type&quot;:  &quot;inline&quot;,</div>
<div class="line">                                           &quot;description&quot;:  &quot;Install libcurl4-doc on host device&quot;,</div>
<div class="line">                                           &quot;handler&quot;:  &quot;microsoft/apt:1&quot;,</div>
<div class="line">                                           &quot;files&quot;:  [</div>
<div class="line">                                                         &quot;apt-manifest-1.0.json&quot;</div>
<div class="line">                                                     ],</div>
<div class="line">                                           &quot;handlerProperties&quot;:  {</div>
<div class="line">                                                                     &quot;installedCriteria&quot;:  &quot;apt-update-test-2.2&quot;</div>
<div class="line">                                                                 }</div>
<div class="line">                                       },</div>
<div class="line">                                       {</div>
<div class="line">                                           &quot;type&quot;:  &quot;inline&quot;,</div>
<div class="line">                                           &quot;description&quot;:  &quot;Install tree on host device&quot;,</div>
<div class="line">                                           &quot;handler&quot;:  &quot;microsoft/apt:1&quot;,</div>
<div class="line">                                           &quot;files&quot;:  [</div>
<div class="line">                                                         &quot;apt-manifest-tree-1.0.json&quot;</div>
<div class="line">                                                     ],</div>
<div class="line">                                           &quot;handlerProperties&quot;:  {</div>
<div class="line">                                                                     &quot;installedCriteria&quot;:  &quot;apt-update-test-tree-2.2&quot;</div>
<div class="line">                                                                 }</div>
<div class="line">                                       }</div>
<div class="line">                                   ]</div>
<div class="line">                     },</div>
<div class="line">    &quot;files&quot;:  [</div>
<div class="line">                  {</div>
<div class="line">                      &quot;filename&quot;:  &quot;apt-manifest-1.0.json&quot;,</div>
<div class="line">                      &quot;sizeInBytes&quot;:  124,</div>
<div class="line">                      &quot;hashes&quot;:  {</div>
<div class="line">                                     &quot;sha256&quot;:  &quot;cjJdOa7v4bYyKUrCtF7cSTuPyhfWt8BYkujGtkRDjJ8=&quot;</div>
<div class="line">                                 }</div>
<div class="line">                  },</div>
<div class="line">                  {</div>
<div class="line">                      &quot;filename&quot;:  &quot;apt-manifest-tree-1.0.json&quot;,</div>
<div class="line">                      &quot;sizeInBytes&quot;:  138,</div>
<div class="line">                      &quot;hashes&quot;:  {</div>
<div class="line">                                     &quot;sha256&quot;:  &quot;8vEB0TLIWS6PFkQhJqlcY8ZGiEZGoZALLF9Yx6wP2XA=&quot;</div>
<div class="line">                                 }</div>
<div class="line">                  }</div>
<div class="line">              ],</div>
<div class="line">    &quot;createdDateTime&quot;:  &quot;2022-05-13T21:47:36.3189977Z&quot;,</div>
<div class="line">    &quot;manifestVersion&quot;:  &quot;4.0&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>This import manifest contains steps that use 'microsoft/apt:1' handler type. Each step requires a corresponding <a class="el" href="classAPT.html" title="Exception throw by APT Parser.">APT</a> manifest containing information about the package to be installed.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md9"></a>
Tutorial 3 - Bundle Update and Multi Component Update</h1>
<p>A <b>Bundle Update</b> is an update that contains at least one reference step.</p>
<p>A <b>Multi Component Update</b> is a Bundle Update intended for a device with a registered <code>Component Enumerator Extension</code>.</p>
<blockquote class="doxtable">
<p>If the target device doesn't have a registered component enumerator, the Device Update Agent will assume that every step is intended to be installed onto the host device and will not pass any 'Component Context' to the Step Handler when processing steps.</p>
<p>See <a href="../../../../../extensions/update_manifest_handlers/steps_handler/">Steps Handler</a> for more information. </p>
</blockquote>
<p>Follow this <a href="#generate-example-updates">instruction</a> to generate the example update using <code>CreateSampleMSOEUpdate-3.x.ps1</code> PowerShell script.</p>
<p><b>Important</b> - follow this <a href="#register-contoso-components-enumerator-extension">instruction</a> to register the example Contoso Component Enumerator and Components Inventory file.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Example Import Manifest - Contoso.Virtual-Vacuum.3.3</h2>
<p>This import manifest contains a single reference step that requires the <a href="#example-import-manifest-for-reference-update-virtual-vacuum-virtual-camera-14">contoso Virtual-Vacuum-virtual-camera 1.4</a> update to be imported simultaneously.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;updateId&quot;:  {</div>
<div class="line">                     &quot;provider&quot;:  &quot;Contoso&quot;,</div>
<div class="line">                     &quot;name&quot;:  &quot;Virtual-Vacuum&quot;,</div>
<div class="line">                     &quot;version&quot;:  &quot;3.3&quot;</div>
<div class="line">                 },</div>
<div class="line">    &quot;isDeployable&quot;:  true,</div>
<div class="line">    &quot;compatibility&quot;:  [</div>
<div class="line">                          {</div>
<div class="line">                              &quot;model&quot;:  &quot;virtual-vacuum-v1&quot;,</div>
<div class="line">                              &quot;manufacturer&quot;:  &quot;contoso&quot;</div>
<div class="line">                          }</div>
<div class="line">                      ],</div>
<div class="line">    &quot;instructions&quot;:  {</div>
<div class="line">                         &quot;steps&quot;:  [</div>
<div class="line">                                       {</div>
<div class="line">                                           &quot;type&quot;:  &quot;reference&quot;,</div>
<div class="line">                                           &quot;description&quot;:  &quot;Cameras Firmware Update&quot;,</div>
<div class="line">                                           &quot;updateId&quot;:  {</div>
<div class="line">                                                            &quot;provider&quot;:  &quot;contoso&quot;,</div>
<div class="line">                                                            &quot;name&quot;:  &quot;Virtual-Vacuum-virtual-camera&quot;,</div>
<div class="line">                                                            &quot;version&quot;:  &quot;1.4&quot;</div>
<div class="line">                                                        }</div>
<div class="line">                                       }</div>
<div class="line">                                   ]</div>
<div class="line">                     },</div>
<div class="line">    &quot;createdDateTime&quot;:  &quot;2022-09-19T04:02:43.9745720Z&quot;,</div>
<div class="line">    &quot;manifestVersion&quot;:  &quot;4.0&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md11"></a>
Example Import Manifest for the reference update Virtual-vacuum-virtual-camera 1.4</h3>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;updateId&quot;:  {</div>
<div class="line">                     &quot;provider&quot;:  &quot;contoso&quot;,</div>
<div class="line">                     &quot;name&quot;:  &quot;Virtual-Vacuum-virtual-camera&quot;,</div>
<div class="line">                     &quot;version&quot;:  &quot;1.4&quot;</div>
<div class="line">                 },</div>
<div class="line">    &quot;isDeployable&quot;:  false,</div>
<div class="line">    &quot;compatibility&quot;:  [</div>
<div class="line">                          {</div>
<div class="line">                              &quot;group&quot;:  &quot;cameras&quot;</div>
<div class="line">                          }</div>
<div class="line">                      ],</div>
<div class="line">    &quot;instructions&quot;:  {</div>
<div class="line">                         &quot;steps&quot;:  [</div>
<div class="line">                                       {</div>
<div class="line">                                           &quot;type&quot;:  &quot;inline&quot;,</div>
<div class="line">                                           &quot;description&quot;:  &quot;Cameras Update - pre-install step (failure - missing file)&quot;,</div>
<div class="line">                                           &quot;handler&quot;:  &quot;microsoft/script:1&quot;,</div>
<div class="line">                                           &quot;files&quot;:  [</div>
<div class="line">                                                         &quot;contoso-camera-installscript.sh&quot;</div>
<div class="line">                                                     ],</div>
<div class="line">                                           &quot;handlerProperties&quot;:  {</div>
<div class="line">                                                                     &quot;scriptFileName&quot;:  &quot;contoso-camera-installscript.sh&quot;,</div>
<div class="line">                                                                     &quot;arguments&quot;:  &quot;--pre-install-sim-success --component-name --component-name-val --component-group --component-group-val --component-prop path --component-prop-val path&quot;,</div>
<div class="line">                                                                     &quot;installedCriteria&quot;:  &quot;1.1&quot;</div>
<div class="line">                                                                 }</div>
<div class="line">                                       },</div>
<div class="line">                                       {</div>
<div class="line">                                           &quot;type&quot;:  &quot;inline&quot;,</div>
<div class="line">                                           &quot;description&quot;:  &quot;Cameras Update - firmware installation&quot;,</div>
<div class="line">                                           &quot;handler&quot;:  &quot;microsoft/script:1&quot;,</div>
<div class="line">                                           &quot;files&quot;:  [</div>
<div class="line">                                                         &quot;contoso-camera-installscript.sh&quot;,</div>
<div class="line">                                                         &quot;camera-firmware-1.1.json&quot;</div>
<div class="line">                                                     ],</div>
<div class="line">                                           &quot;handlerProperties&quot;:  {</div>
<div class="line">                                                                     &quot;scriptFileName&quot;:  &quot;contoso-camera-installscript.sh&quot;,</div>
<div class="line">                                                                     &quot;arguments&quot;:  &quot;--firmware-file camera-firmware-1.1.json --component-name --component-name-val --component-group --component-group-val --component-prop path --component-prop-val path&quot;,</div>
<div class="line">                                                                     &quot;installedCriteria&quot;:  &quot;1.1&quot;</div>
<div class="line">                                                                 }</div>
<div class="line">                                       },</div>
<div class="line">                                       {</div>
<div class="line">                                           &quot;type&quot;:  &quot;inline&quot;,</div>
<div class="line">                                           &quot;description&quot;:  &quot;Cameras Update - post-install script&quot;,</div>
<div class="line">                                           &quot;handler&quot;:  &quot;microsoft/script:1&quot;,</div>
<div class="line">                                           &quot;files&quot;:  [</div>
<div class="line">                                                         &quot;contoso-camera-installscript.sh&quot;</div>
<div class="line">                                                     ],</div>
<div class="line">                                           &quot;handlerProperties&quot;:  {</div>
<div class="line">                                                                     &quot;scriptFileName&quot;:  &quot;contoso-camera-installscript.sh&quot;,</div>
<div class="line">                                                                     &quot;arguments&quot;:  &quot;--post-install-sim-success --component-name --component-name-val --component-group --component-group-val --component-prop path --component-prop-val path&quot;,</div>
<div class="line">                                                                     &quot;installedCriteria&quot;:  &quot;1.1&quot;</div>
<div class="line">                                                                 }</div>
<div class="line">                                       }</div>
<div class="line">                                   ]</div>
<div class="line">                     },</div>
<div class="line">    &quot;files&quot;:  [</div>
<div class="line">                  {</div>
<div class="line">                      &quot;filename&quot;:  &quot;contoso-camera-installscript.sh&quot;,</div>
<div class="line">                      &quot;sizeInBytes&quot;:  26884,</div>
<div class="line">                      &quot;hashes&quot;:  {</div>
<div class="line">                                     &quot;sha256&quot;:  &quot;K6F2TUmY2JPtp6vWI8bNl6sVceacBFTHXIyhOOmS1x8=&quot;</div>
<div class="line">                                 }</div>
<div class="line">                  },</div>
<div class="line">                  {</div>
<div class="line">                      &quot;filename&quot;:  &quot;camera-firmware-1.1.json&quot;,</div>
<div class="line">                      &quot;sizeInBytes&quot;:  124,</div>
<div class="line">                      &quot;hashes&quot;:  {</div>
<div class="line">                                     &quot;sha256&quot;:  &quot;6jst7Roi7dbeb3BNokQo6Gea5qsPPu2KDJ6GotaOQi4=&quot;</div>
<div class="line">                                 }</div>
<div class="line">                  }</div>
<div class="line">              ],</div>
<div class="line">    &quot;createdDateTime&quot;:  &quot;2022-09-19T04:02:43.9465570Z&quot;,</div>
<div class="line">    &quot;manifestVersion&quot;:  &quot;4.0&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md12"></a>
Example Import Manifest - Contoso.Virtual-Vacuum-virtual-camera.1.4</h2>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;updateId&quot;:  {</div>
<div class="line">                     &quot;provider&quot;:  &quot;contoso&quot;,</div>
<div class="line">                     &quot;name&quot;:  &quot;Virtual-Vacuum-virtual-camera&quot;,</div>
<div class="line">                     &quot;version&quot;:  &quot;1.4&quot;</div>
<div class="line">                 },</div>
<div class="line">    &quot;isDeployable&quot;:  false,</div>
<div class="line">    &quot;compatibility&quot;:  [</div>
<div class="line">                          {</div>
<div class="line">                              &quot;group&quot;:  &quot;cameras&quot;</div>
<div class="line">                          }</div>
<div class="line">                      ],</div>
<div class="line">    &quot;instructions&quot;:  {</div>
<div class="line">                         &quot;steps&quot;:  [</div>
<div class="line">                                       {</div>
<div class="line">                                           &quot;type&quot;:  &quot;inline&quot;,</div>
<div class="line">                                           &quot;description&quot;:  &quot;Cameras Update - firmware installation&quot;,</div>
<div class="line">                                           &quot;handler&quot;:  &quot;microsoft/script:1&quot;,</div>
<div class="line">                                           &quot;files&quot;:  [</div>
<div class="line">                                                         &quot;contoso-camera-installscript.sh&quot;,</div>
<div class="line">                                                         &quot;camera-firmware-1.1.json&quot;</div>
<div class="line">                                                     ],</div>
<div class="line">                                           &quot;handlerProperties&quot;:  {</div>
<div class="line">                                                                     &quot;scriptFileName&quot;:  &quot;contoso-camera-installscript.sh&quot;,</div>
<div class="line">                                                                     &quot;arguments&quot;:  &quot;--firmware-file camera-firmware-1.1.json --component-name --component-name-val --component-group --component-group-val --component-prop path --component-prop-val path&quot;,</div>
<div class="line">                                                                     &quot;installedCriteria&quot;:  &quot;1.4&quot;</div>
<div class="line">                                                                 }</div>
<div class="line">                                       }</div>
<div class="line">                                   ]</div>
<div class="line">                     },</div>
<div class="line">    &quot;files&quot;:  [</div>
<div class="line">                  {</div>
<div class="line">                      &quot;filename&quot;:  &quot;contoso-camera-installscript.sh&quot;,</div>
<div class="line">                      &quot;sizeInBytes&quot;:  27849,</div>
<div class="line">                      &quot;hashes&quot;:  {</div>
<div class="line">                                     &quot;sha256&quot;:  &quot;aj2H25P9GnRyAQg4wfiixJToUkDOsch3YQ0fNgHn4as=&quot;</div>
<div class="line">                                 }</div>
<div class="line">                  },</div>
<div class="line">                  {</div>
<div class="line">                      &quot;filename&quot;:  &quot;camera-firmware-1.1.json&quot;,</div>
<div class="line">                      &quot;sizeInBytes&quot;:  130,</div>
<div class="line">                      &quot;hashes&quot;:  {</div>
<div class="line">                                     &quot;sha256&quot;:  &quot;6lYoRUnOVymga/7YH6qSKHv0osG4MFpfSW+naOq7/4M=&quot;</div>
<div class="line">                                 }</div>
<div class="line">                  }</div>
<div class="line">              ],</div>
<div class="line">    &quot;createdDateTime&quot;:  &quot;2022-05-13T22:49:03.4040790Z&quot;,</div>
<div class="line">    &quot;manifestVersion&quot;:  &quot;4.0&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The above update contains a single inline step that installs <code>camera firmware v1.1</code> onto every compatible <code>component</code> that is currently connected to a host device (as reported by the registered Component Enumerator extension).</p>
<p>When the Component Enumerator extension is registered, the Device Update agent will <b>select</b> the compatible <code>component</code> by invoking a <code>SelectComponents</code> api and passing the referenced-update's compatibility property as a <code>selector</code>. For this example, the component enumerator will return every component with a <code>group</code> property value that equals <code>cameras</code>.</p>
<p>When processing this step, the Agent will iterate through the list of returned compatible components and perform the step's actions (download, install, apply) on each component with each component's context accordingly. See <a href="../../../../../extensions/step_handlers/steps_handler/">Steps Handler</a> and ../../contoso_component_enumerator/README.md "Component Enumerator Extension" for more details.</p>
<hr  />
 <h1><a class="anchor" id="autotoc_md14"></a>
Appendix</h1>
<h2><a class="anchor" id="autotoc_md15"></a>
Setup Test Device</h2>
<p>Prerequisites</p>
<ul>
<li>A test device with Ubuntu 18.04 LTS (or Virtual Machine)</li>
<li>Connection to the internet </li>
</ul>
<h3><a class="anchor" id="autotoc_md16"></a>
Install the Device Update Agent and Dependencies</h3>
<ul>
<li><p class="startli">Register packages.microsoft.com in <a class="el" href="classAPT.html" title="Exception throw by APT Parser.">APT</a> package repository</p>
<p class="startli">```sh curl <a href="https://packages.microsoft.com/config/ubuntu/18.04/multiarch/prod.list">https://packages.microsoft.com/config/ubuntu/18.04/multiarch/prod.list</a> &gt; ~/microsoft-prod.list</p>
<p class="startli">sudo cp ~/microsoft-prod.list /etc/apt/sources.list.d/</p>
<p class="startli">curl <a href="https://packages.microsoft.com/keys/microsoft.asc">https://packages.microsoft.com/keys/microsoft.asc</a> | gpg &ndash;dearmor &gt; ~/microsoft.gpg</p>
<p class="startli">sudo cp ~/microsoft.gpg /etc/apt/trusted.gpg.d/</p>
<p class="startli">sudo apt-get update ```</p>
</li>
<li>Install test <b>deviceupdate-agent-[version].deb</b> package on the test device. e.g.</li>
</ul>
<div class="fragment"><div class="line">sudo apt-get install ./deviceupdate-agent-0.8.0-public-preview-refresh.deb</div>
</div><!-- fragment --><p>Note: this will automatically install the delivery-optimization-agent package from packages.microsoft.com</p>
<ul>
<li>Specify a connection string in /etc/adu/du-config.json</li>
</ul>
<p>&gt;NOTE | The current example only compatible with device with "contoso" manufacturer, and "virtual-vacuum-v1" model. These values must be correctly set inside <code>agents</code> entry in du-config.json</p>
<ul>
<li>Restart <code>deviceupdate-agent</code> service</li>
</ul>
<div class="fragment"><div class="line">sudo systemctl restart deviceupdate-agent</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md17"></a>
Optional Steps</h2>
<p>The following optional steps are required for Multi Component Update (a.k.a. Proxy Update).</p>
<h3><a class="anchor" id="autotoc_md18"></a>
Register Contoso Components Enumerator extension</h3>
<p>Run following command on your test device</p>
<div class="fragment"><div class="line">sudo /usr/bin/AducIotAgent -E /var/lib/adu/extensions/sources/libcontoso_component_enumerator.so</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md19"></a>
Setup Mock Components</h3>
<p>For testing and demonstration purposes, we'll be creating following mock components on the device:</p>
<ul>
<li>3 motors</li>
<li>2 cameras</li>
<li>hostfs</li>
<li>rootfs</li>
</ul>
<p><b>IMPORTANT</b> This components configuration depends on the implementation of an example Component Enumerator extension called libcontoso_component_enumerator.so, which required a mock component inventory data file <code>/usr/local/contoso-devices/components-inventory.json</code></p>
<blockquote class="doxtable">
<p>Tip: you can copy <a href="../demo">demo</a> folder to your home directory on the test VM and run <code>sudo ~/demo/tools/reset-demo-components.sh</code> to copy required files to the right locations. </p>
</blockquote>
<h3><a class="anchor" id="autotoc_md20"></a>
Add /usr/local/contoso-devices/components-inventory.json</h3>
<ul>
<li>Copy <a href="./demo-devices/contoso-devices/components-inventory.json">components-inventory.json</a> to **/usr/local/contoso-devices** folder</li>
</ul>
<h2><a class="anchor" id="autotoc_md21"></a>
Generate Example Updates</h2>
<p>Open PowerShell terminal, go <a href="../../../../../../tools/AduCmdlets/">[project-root]/tools/AduCmdlets</a> directory, then import AduUpdate.psm1 module:</p>
<div class="fragment"><div class="line">Import-Module ./AduUpdate.psm1</div>
</div><!-- fragment --><p>Next, go to <a href="./sample-updates/">sample-updates</a> directory, then run following commands to generate <b>all</b> example updates:</p>
<blockquote class="doxtable">
<p>NOTE | You can choose to generate only updates you want to try. </p>
</blockquote>
<div class="fragment"><div class="line">./CreateSampleMSOEUpdate-1.x.ps1</div>
<div class="line">./CreateSampleMSOEUpdate-2.x.ps1</div>
<div class="line">./CreateSampleMSOEUpdate-3.x.ps1</div>
<div class="line">./CreateSampleMSOEUpdate-4.x.ps1</div>
<div class="line">./CreateSampleMSOEUpdate-5.x.ps1</div>
<div class="line">./CreateSampleMSOEUpdate-6.x.ps1</div>
<div class="line">./CreateSampleMSOEUpdate-7.x.ps1</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
